
[[Param]]
comment = 'Start of chip memory mapping'
STRTADD = 0x8000

[[Param]]
comment = '2K ROM'
ROMSIZE = 0x0800

[[Param]]
comment = '''
The code actually needs 4 bytes ram at this address for the command buffer.
However, stack also starts here, and will grow down (towards 0) from this point.
So, we need some above and below this address.  I generally choose the
Top of RAM minus 16'''
RAMADDR = 0xfff0

[[Param]]
comment = 'delay factor'
BIGDEL = 0x0180

[Code]
cartheader = '''
        .db	0xaa	    ; cartridge signature
    	.db	0x55
    	
    	.dw     0x0000
    	.dw     0x0000
    	.dw     0x0000
    	.dw     0x0000
    	.dw     START
    	JP      0x0008
    	JP      0x0010
    	JP      0x0018
    	JP      0x0020
    	JP      0x0028
    	JP      0x0030
    	JP      IRQADD
    	JP      NMIADD
'''

#--------------------------------------------------------------------------
# TITLE DATA
#--------------------------------------------------------------------------
title = '''
    	.asciz  "BY: EVAN&FRANK/DEMON DEBUGGER/2019"
'''

#--------------------------------------------------------------------------
# START Routine
#
# This is called once, and can be used do any target-specific
# initialization that is required
#--------------------------------------------------------------------------
start = '''
;
;       START CODE
;
START:
        DI                  ; Disable interrupts - we don't handle them
        LD      SP,RAMADDR  ; have to set valid SP
;       YOUR CODE CAN GO HERE
        JP      INIT
'''

#--------------------------------------------------------------------------
# EVERY Routine
# This is called regularly, every polling loop, and can be used do any 
# target-specific task that is required, such as hitting a watchdog
#--------------------------------------------------------------------------
every = '''
;
;       EVERY CODE
;
EVERY:
;       YOUR CODE CAN GO HERE
        RET
'''

[[Region]]
code  = [
    { link = "core/dd.def" }, 
    { link = "core/z80.def" },
    { link = "io/romio.def" } 
]

[[Region]]
#---------------------------------------------------
# On the Coleco cart, the start address is 0x8000
#---------------------------------------------------
start = 'STRTADD'
end = 'IOADD'
code = [
    { insert = 'cartheader' },
    { insert = 'title' },
    { insert = 'start' },
    { link = 'core/z80_main.asm'},
    { insert = 'every'},
    { link = 'io/z80_romio.asm'}
]

[[Region]]
start = 'IOADD'
end   = 'IOEND'
code  = [
    { link = "io/romio_table.asm" }
]

[[Region]]    
start = 'IOEND'
end = 'ROMEND'
